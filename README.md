# PPG Gaussian Decomposition & Reflection Wave Analysis for Arterial Stiffness Quantification

## Overview
Photoplethysmography (PPG) contains a forward-traveling incident wave generated by left ventricular ejection and a backward-traveling reflected wave returning from peripheral arterial branches.  
As arteries stiffen, the reflected wave returns earlier and with larger amplitude, producing a pronounced secondary shoulder in the PPG waveform.

This project implements a **Gaussian component decomposition algorithm** that separates the PPG pulse into incident and reflected components, enabling the estimation of key **arterial stiffness biomarkers**:

- **AIx (Augmentation Index)**
- **RT (Reflection Time)**
- **SI (Stiffness Index)**
- **β-index**
- **PTT-based enhancements** (optional ECG synchronization)

---

## Key Features

### 1. Gaussian Mixture-Based Pulse Wave Decomposition
PPG pulse is decomposed as:
- Incident wave (G₁)
- Reflected wave (G₂)
- Optional micro-reflection (G₃)

Algorithms supported:
- **EM (Expectation–Maximization)**
- **NNLS + coordinate descent**
- With constraints:
  - μ₁ < μ₂ < μ₃  
  - A ≥ 0  
  - σ_min ≤ σ ≤ σ_max  
  - Temporal smoothing across adjacent pulses

This yields stable and physiologically meaningful fits.

---

### 2. Reflection-Wave-Based Arterial Stiffness Metrics

**Reflection Time (RT)**  
\[
RT = \frac{\mu_2 - \mu_1}{fs}
\]

**Augmentation Index (AIx)**  
- Amplitude-based:
  \[
  AIx_{\text{amp}} = \frac{A_2}{A_1}
  \]
- Area-based:
  \[
  AIx_{\text{area}} = \frac{\int G_2}{\int G_1}
  \]

**Stiffness Index (SI)**  
\[
SI = \frac{\text{height}}{RT}
\]

**β-index (relative)**  
Approximated using waveform slope, amplitude ratios, or MAP-corrected heuristics.

**Optional PTT Integration (with ECG)**  
- R-peak to PPG foot delay  
- Negative correlation with blood pressure  
- Improves stiffness estimation reliability.

---

### 3. Motion Robustness & Signal Quality Index (SQI)
- Template-matching  
- Pulse interval stability  
- Residual/SNR-based SQI  
- IMU-assisted motion detection (optional)  
- Low-SQI pulses masked or down-weighted  
- Robust statistics (median/IQR) used for summary

---

## Preprocessing & Data Requirements

### Recommended sampling rates
- PPG: **64–256 Hz** (100–128 Hz typical)
- ECG (if used): **128–500 Hz**

### Preprocessing pipeline
- Detrending (0.05–0.3 Hz HPF or smoothing baseline)
- Bandpass filtering (0.5–8 Hz)
- Normalization (RMS or IQR)
- Abnormal pulse removal (0.3–2.0 s outside range)

### Synchronization (optional)
- Align PPG pulses on ECG R-peaks  
- Ensures consistent PTT estimation

---

## Algorithm Workflow

### 1. Pulse Segmentation
- Foot detection via derivative zero-crossing or aPPG-based methods  
- Pulse alignment and amplitude/temporal normalization  
- Stabilizes Gaussian decomposition

### 2. Gaussian Decomposition
**Initialization**
- μ₁ near foot → systolic peak  
- μ₂ after peak (secondary shoulder)  
- A via NNLS  
- σ ≈ 10–25% of pulse width

**Estimation**
- EM (responsibility update → parameter update)  
- Or NNLS + μ,σ coordinate descent  
- Constraints + temporal L2 smoothing

---

### 3. Reflection Indices Computation
- **RT = (μ₂ − μ₁)/fs**
- **AIx (amp/area)**
- **Slope-based metrics (aPPG second derivative)**
- **PTT (optional)**

---

### 4. Arterial Stiffness Indices
- **SI = height / RT**
- **β-index: ln(SBP/DBP) approximated using slope/area ratios**
- **AScore**  
  A fused score combining standardized:
  - AIx  
  - RT  
  - SI  
  - PTT  
  Weighted dynamically by SQI.

---

### 5. Quality Control
- SQI (0–1) from:
  - Pulse-to-pulse variation  
  - Residual RMS  
  - Template correlation  
  - aPPG consistency  
- Low-SQI windows excluded  
- Trimming of outliers  
- Use median/IQR aggregation

---

## Output Metrics
- **AIx_amp**
- **AIx_area**
- **RT (s)**
- **SI (m/s or unitless)**
- **β-index**
- **PTT (s, optional)**
- **AScore (0–100)**
- **SQI summary**
- **Pulse count, residual RMS**

---

## Usage

### 1. Data Preparation
- PPG 100–128 Hz  
- At least 2–5 minutes of stable recording  
- Optional ECG at 128–250 Hz

### 2. Initial Setup
- Window = **12 s**, 50% overlap  
- Gaussian components K=2 (K=3 for young subjects)

### 3. Execution
